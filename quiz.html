<!DOCTYPE html>
<html>
<head>
<title>IP Quiz</title>
<link rel="stylesheet" href="css/style.css">
<style>
.quiz-box{max-width:700px;margin:auto;padding:20px}
button{padding:10px;margin:10px;background:black;color:white;border:none}
.option{display:block;margin:5px 0;padding:10px;border:1px solid #ccc;cursor:pointer}
.correct{background:#c8f7c5}
.wrong{background:#f7c5c5}
</style>
</head>
<body>

<script>
// ðŸ”’ Must login
let user = JSON.parse(localStorage.getItem("ivc_current_user"));
if(!user){
alert("Login first");
window.location="login.html";
}
</script>

<div class="quiz-box">

<h2 id="quizTitle">Quiz</h2>
<p>Time Left: <span id="time">0</span>s</p>

<div id="quizArea"></div>

<button onclick="next()">Next</button>

<h3 id="result"></h3>

</div>

<script>

// Load Admin Data
let quizzes = JSON.parse(localStorage.getItem("quizzes")) || [];
let passmark = parseInt(localStorage.getItem("passmark")) || 60;
let timer = parseInt(localStorage.getItem("timer")) || 30;

let index=0;
let score=0;
let timeLeft = timer;
let countdown;

// Start
startQuiz();

function startQuiz(){
if(quizzes.length===0){
document.getElementById("quizArea").innerHTML="No quiz uploaded by admin";
return;
}
showQuestion();
startTimer();
}

function showQuestion(){

if(index>=quizzes.length){
finish();
return;
}

let q = quizzes[index];

document.getElementById("quizTitle").innerText = q.category.toUpperCase()+" Quiz";

let html = `<h3>${q.question}</h3>`;

q.options.forEach((opt,i)=>{
html+=`<div class="option" onclick="answer(${i},this)">${opt}</div>`;
});

document.getElementById("quizArea").innerHTML = html;
}

function answer(i,el){

let q = quizzes[index];

let options = document.querySelectorAll(".option");

options.forEach(o=>o.style.pointerEvents="none");

if(i===q.answer){
score++;
el.classList.add("correct");
}else{
el.classList.add("wrong");
options[q.answer].classList.add("correct");
}
}

function next(){
index++;
showQuestion();
resetTimer();
}

function finish(){

clearInterval(countdown);

let percent = Math.round((score/quizzes.length)*100);

let msg = percent>=passmark ? "PASS" : "FAIL";

document.getElementById("quizArea").innerHTML="";
document.getElementById("result").innerHTML=
"Score: "+percent+"% ("+msg+")";

updateLeaderboard(percent,msg);
generateCertificate(percent,msg);
}

function startTimer(){
timeLeft = timer;
document.getElementById("time").innerText=timeLeft;
countdown=setInterval(()=>{
timeLeft--;
document.getElementById("time").innerText=timeLeft;
if(timeLeft<=0){
next();
}
},1000);
}

function resetTimer(){
clearInterval(countdown);
startTimer();
}

// ðŸ† Leaderboard
function updateLeaderboard(percent,msg){

let board = JSON.parse(localStorage.getItem("leaderboard"))||[];

board.push({
name:user.name,
score:percent
});

board.sort((a,b)=>b.score-a.score);

localStorage.setItem("leaderboard", JSON.stringify(board));
}

// ðŸŽ“ Certificate
function generateCertificate(percent,msg){

if(msg==="PASS"){

let cert = {
name:user.name,
score:percent,
date:new Date().toLocaleDateString()
};

localStorage.setItem("certificate", JSON.stringify(cert));

alert("Certificate Earned!");
}
}

</script>

</body>
</html>
