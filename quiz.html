<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IP Quizzes</title>
<link rel="stylesheet" href="css/style.css">
</head>
<body>

<nav class="navbar">
    <img src="images/logo.png" class="logo-nav">
</nav>

<h1>Select IP Quiz</h1>

<select id="quizCategory">
    <option value="">Choose Quiz</option>
    <option value="patent">Patent</option>
    <option value="trademark">Trademark</option>
    <option value="copyright">Copyright</option>
</select>

<button onclick="startQuiz()">Start</button>

<h3 id="timer"></h3>

<div id="quizBox"></div>
<button onclick="submitQuiz()">Submit</button>

<div id="results"></div>
<button onclick="generateCertificate()" id="certBtn" style="display:none;">
Download Certificate
</button>

<script>

let PASS_MARK = 60;
let TIME_LIMIT = 60;
let timer;
let timeLeft = TIME_LIMIT;

let quizzes = JSON.parse(localStorage.getItem("ivc_quizzes")) || {
patent:[
{q:"Patent protects?",options:["Logo","Invention","Music"],answer:1}
],
trademark:[
{q:"Trademark protects?",options:["Brand","Idea","Machine"],answer:0}
],
copyright:[
{q:"Copyright protects?",options:["Book","Machine","Logo"],answer:0}
]
};

localStorage.setItem("ivc_quizzes", JSON.stringify(quizzes));

let currentQuiz=[];

function startQuiz(){
let category = document.getElementById("quizCategory").value;
if(!category) return alert("Choose category");

currentQuiz = quizzes[category];
document.getElementById("quizBox").innerHTML="";

currentQuiz.forEach((q,i)=>{
let div = document.createElement("div");
div.innerHTML = `<h3>${q.q}</h3>` +
q.options.map((opt,index)=>
`<label><input type="radio" name="q${i}" value="${index}">${opt}</label><br>`
).join("");
document.getElementById("quizBox").appendChild(div);
});

startTimer();
}

function startTimer(){
timeLeft = TIME_LIMIT;
document.getElementById("timer").innerText = "Time: " + timeLeft;

timer = setInterval(()=>{
timeLeft--;
document.getElementById("timer").innerText = "Time: " + timeLeft;

if(timeLeft<=0){
clearInterval(timer);
submitQuiz();
}
},1000);
}

function submitQuiz(){
clearInterval(timer);
let score=0;
let corrections="";

currentQuiz.forEach((q,i)=>{
let selected = document.querySelector(`input[name=q${i}]:checked`);
let answer = selected ? parseInt(selected.value) : -1;

if(answer===q.answer){
score++;
}else{
corrections+=`
<p>Wrong: ${q.q}<br>
Correct: ${q.options[q.answer]}</p>`;
}
});

let percent = (score/currentQuiz.length)*100;

document.getElementById("results").innerHTML =
`Score: ${percent}%<br>${corrections}`;

if(percent >= PASS_MARK){
document.getElementById("certBtn").style.display="block";
alert("You passed!");
updateLeaderboard(percent);
}else{
alert("You failed. Pass mark is 60%");
}
}

function updateLeaderboard(score){
let user = JSON.parse(localStorage.getItem("ivc_current_user"));
let board = JSON.parse(localStorage.getItem("ivc_leaderboard")) || [];

board.push({
name:user.name,
score:score
});

board.sort((a,b)=>b.score-a.score);

localStorage.setItem("ivc_leaderboard", JSON.stringify(board));
}

function generateCertificate(){
let user = JSON.parse(localStorage.getItem("ivc_current_user"));
let win = window.open("","");
win.document.write(`
<h1>IDEA VAULT CLUB</h1>
<h2>Certificate of Achievement</h2>
<p>This certifies that</p>
<h2>${user.name}</h2>
<p>Has passed an IP Quiz</p>
<p>Date: ${new Date().toLocaleDateString()}</p>
`);
}

</script>

</body>
</html>
